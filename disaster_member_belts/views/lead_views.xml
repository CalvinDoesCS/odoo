<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ─────────────────────────────────────────────────────────────
         disaster.lead  –  Leads &amp; Trial Pipeline Views
         ───────────────────────────────────────────────────────────── -->

    <!-- LIST -->
    <record id="view_disaster_lead_list" model="ir.ui.view">
        <field name="name">disaster.lead.list</field>
        <field name="model">disaster.lead</field>
        <field name="arch" type="xml">
            <list string="Leads" decoration-success="stage=='converted'"
                  decoration-muted="stage=='lost'" decoration-info="stage=='trial'">
                <field name="name"/>
                <field name="phone"/>
                <field name="email"/>
                <field name="source"/>
                <field name="stage" widget="badge"
                       decoration-success="stage in ('trial','converted')"
                       decoration-danger="stage=='lost'"
                       decoration-warning="stage=='appointment'"
                       decoration-info="stage=='contacted'"/>
                <field name="assigned_user_id"/>
                <field name="days_in_stage" string="Days in Stage"/>
                <field name="trial_start_date" optional="hide"/>
                <field name="trial_end_date" optional="hide"/>
                <field name="referred_by_id" optional="hide"/>
            </list>
        </field>
    </record>

    <!-- FORM -->
    <record id="view_disaster_lead_form" model="ir.ui.view">
        <field name="name">disaster.lead.form</field>
        <field name="model">disaster.lead</field>
        <field name="arch" type="xml">
            <form string="Lead">
                <header>
                    <button name="action_contact"
                            string="Mark Contacted"
                            type="object"
                            class="btn-secondary"
                            invisible="stage not in ('new',)"/>
                    <button name="action_set_appointment"
                            string="Book Appointment"
                            type="object"
                            class="btn-secondary"
                            invisible="stage not in ('new','contacted')"/>
                    <button name="action_start_trial"
                            string="Start Trial"
                            type="object"
                            class="btn-primary"
                            invisible="stage in ('trial','converted','lost')"/>
                    <button name="action_convert"
                            string="Convert to Member ✓"
                            type="object"
                            class="btn-primary"
                            invisible="stage in ('converted','lost')"/>
                    <button name="action_mark_lost"
                            string="Mark Lost"
                            type="object"
                            class="btn-danger"
                            invisible="stage in ('converted','lost')"/>
                    <field name="stage" widget="statusbar"
                           statusbar_visible="new,contacted,appointment,trial,converted"/>
                </header>
                <sheet>
                    <group>
                        <group string="Contact">
                            <field name="name"/>
                            <field name="phone"/>
                            <field name="email"/>
                            <field name="partner_id"/>
                        </group>
                        <group string="Pipeline">
                            <field name="source"/>
                            <field name="referred_by_id"/>
                            <field name="assigned_user_id"/>
                            <field name="appointment_date"/>
                        </group>
                    </group>
                    <group string="Trial">
                        <field name="trial_plan_id"/>
                        <field name="trial_start_date"/>
                        <field name="trial_end_date"/>
                        <field name="trial_contract_id" readonly="1"/>
                    </group>
                    <field name="notes" placeholder="Notes about this lead..."/>
                    <field name="lost_reason" invisible="stage != 'lost'"/>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- KANBAN -->
    <record id="view_disaster_lead_kanban" model="ir.ui.view">
        <field name="name">disaster.lead.kanban</field>
        <field name="model">disaster.lead</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage" class="o_kanban_small_column">
                <field name="stage"/>
                <field name="name"/>
                <field name="phone"/>
                <field name="email"/>
                <field name="source"/>
                <field name="assigned_user_id"/>
                <field name="days_in_stage"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click">
                            <strong><field name="name"/></strong>
                            <div class="text-muted small">
                                <field name="phone"/> · <field name="email"/>
                            </div>
                            <div class="mt-1">
                                <span class="badge bg-secondary">
                                    <field name="source"/>
                                </span>
                                <span class="badge bg-info ms-1"
                                      t-if="record.days_in_stage.value > 3">
                                    <t t-esc="record.days_in_stage.value"/> days
                                </span>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- SEARCH -->
    <record id="view_disaster_lead_search" model="ir.ui.view">
        <field name="name">disaster.lead.search</field>
        <field name="model">disaster.lead</field>
        <field name="arch" type="xml">
            <search string="Search Leads">
                <field name="name"/>
                <field name="phone"/>
                <field name="email"/>
                <field name="referred_by_id"/>
                <filter string="New" name="f_new" domain="[('stage','=','new')]"/>
                <filter string="Contacted" name="f_contacted" domain="[('stage','=','contacted')]"/>
                <filter string="Trial" name="f_trial" domain="[('stage','=','trial')]"/>
                <filter string="Converted" name="f_converted" domain="[('stage','=','converted')]"/>
                <filter string="Lost" name="f_lost" domain="[('stage','=','lost')]"/>
                <separator/>
                <filter string="My Leads" name="f_mine" domain="[('assigned_user_id','=',uid)]"/>
                <separator/>
                <filter string="Stage" name="gb_stage" context="{'group_by':'stage'}"/>
                <filter string="Source" name="gb_source" context="{'group_by':'source'}"/>
                <filter string="Assigned To" name="gb_user" context="{'group_by':'assigned_user_id'}"/>
            </search>
        </field>
    </record>

    <!-- ACTION -->
    <record id="action_disaster_lead" model="ir.actions.act_window">
        <field name="name">Leads &amp; Pipeline</field>
        <field name="res_model">disaster.lead</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="view_disaster_lead_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No leads yet. Add your first prospect!
            </p>
        </field>
    </record>

</odoo>
