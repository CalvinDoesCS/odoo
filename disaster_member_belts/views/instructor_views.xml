<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ============================================================
         Instructor – Kanban
    ============================================================ -->
    <record id="view_instructor_kanban" model="ir.ui.view">
        <field name="name">res.partner.instructor.kanban</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <kanban quick_create="false" class="o_kanban_small_column">
                <field name="name"/>
                <field name="instructor_specializations"/>
                <field name="instructor_belt_rank"/>
                <field name="assigned_member_count"/>
                <field name="image_128" widget="image"/>
                <field name="phone"/>
                <field name="email"/>
                <templates>
                    <t t-name="card">
                        <div class="d-flex align-items-center gap-3 mb8">
                            <img t-att-src="kanban_image('res.partner', 'image_128', record.id.value)"
                                 class="rounded-circle"
                                 style="width:56px;height:56px;object-fit:cover;"
                                 alt=""/>
                            <div>
                                <strong><field name="name"/></strong>
                                <div class="text-muted small">
                                    <t t-if="record.instructor_belt_rank.value">
                                        <field name="instructor_belt_rank"/> belt
                                    </t>
                                </div>
                                <div class="text-muted small">
                                    <field name="instructor_specializations"/>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex gap-3">
                            <span class="badge text-bg-primary">
                                <i class="fa fa-users me-1" title="Students"/>
                                <field name="assigned_member_count"/> students
                            </span>
                        </div>
                        <div class="mt8 text-muted small">
                            <t t-if="record.phone.value">
                                <i class="fa fa-phone me-1" title="Phone"/><field name="phone"/>
                            </t>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- ============================================================
         Instructor – List
    ============================================================ -->
    <record id="view_instructor_list" model="ir.ui.view">
        <field name="name">res.partner.instructor.list</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list string="Instructors">
                <field name="name"/>
                <field name="instructor_specializations" string="Specializations"/>
                <field name="instructor_belt_rank" string="Belt"/>
                <field name="assigned_member_count" string="Students"/>
                <field name="phone"/>
                <field name="email"/>
            </list>
        </field>
    </record>

    <!-- ============================================================
         Instructor – Form extension
         Inherits the disaster belt-rank form.
    ============================================================ -->
    <record id="view_partner_instructor_form" model="ir.ui.view">
        <field name="name">res.partner.instructor.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="disaster_member_belts.view_partner_belt_rank_form"/>
        <field name="arch" type="xml">

            <!-- Smart button: assigned students -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_assigned_students" type="object"
                        class="oe_stat_button" icon="fa-users"
                        invisible="not is_instructor">
                    <field name="assigned_member_count" widget="statinfo" string="Students"/>
                </button>
            </xpath>

            <!-- Instructor profile fields -->
            <xpath expr="//field[@name='is_instructor']" position="after">
                <field name="instructor_specializations"
                       placeholder="e.g. Karate, BJJ, Kids Classes"
                       invisible="not is_instructor"/>
                <field name="instructor_belt_rank"
                       invisible="not is_instructor"/>
            </xpath>

            <!-- Instructor notebook page -->
            <xpath expr="//notebook" position="inside">
                <page string="Instructor Profile" invisible="not is_instructor">
                    <group string="Bio">
                        <field name="instructor_bio" nolabel="1"
                               placeholder="Background, certifications, teaching philosophy…"/>
                    </group>
                    <separator string="Assigned Students"/>
                    <field name="assigned_member_ids" widget="many2many_list">
                        <list>
                            <field name="name"/>
                            <field name="belt_rank"/>
                            <field name="member_stage"/>
                            <field name="attendance_count"/>
                            <field name="ready_for_test"/>
                        </list>
                    </field>
                </page>
            </xpath>

        </field>
    </record>

    <!-- ============================================================
         Actions
    ============================================================ -->
    <record id="action_instructor_kanban" model="ir.actions.act_window">
        <field name="name">Instructors</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_instructor', '=', True)]</field>
        <field name="context">{'default_is_instructor': True}</field>
        <field name="view_ids" eval="[(5,0,0),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_instructor_kanban')}),
            (0, 0, {'view_mode': 'list',   'view_id': ref('view_instructor_list')}),
        ]"/>
    </record>

</odoo>
