<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ============================================================
         hr.employee form – add a "Dojo Instructor" tab
    ============================================================ -->
    <record id="view_hr_employee_dojo_form" model="ir.ui.view">
        <field name="name">hr.employee.dojo.instructor.form</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">

            <!-- Always-visible toggle in the Settings tab header area -->
            <xpath expr="//notebook/page[@name='hr_settings']" position="after">
                <page name="dojo_instructor" string="Dojo Instructor">
                    <group>
                        <group string="Instructor Status">
                            <field name="is_dojo_instructor"/>
                        </group>
                    </group>
                    <group invisible="not is_dojo_instructor">
                        <group string="Dojo Details">
                            <field name="instructor_belt_rank"/>
                            <field name="instructor_specializations"
                                   placeholder="e.g. BJJ, Kids Classes, Competition Prep"/>
                        </group>
                        <group string="Dojo Member Profile">
                            <field name="dojo_partner_id" readonly="1"/>
                        </group>
                    </group>
                    <group invisible="not is_dojo_instructor" string="Bio">
                        <field name="instructor_bio"
                               nolabel="1"
                               placeholder="Short instructor biography displayed in the dojo app…"/>
                    </group>
                    <div invisible="is_dojo_instructor"
                         class="alert alert-info" role="alert">
                        Tick <strong>Is Dojo Instructor</strong> above to reveal
                        instructor-specific fields.
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- ============================================================
         res.partner form – add "Create Employee Profile" stat button
         Visible only for instructors who don't yet have an HR record.
         The hr module separately adds the "Employees" smart button
         once the employee record exists.
    ============================================================ -->
    <record id="view_partner_create_employee_btn" model="ir.ui.view">
        <field name="name">res.partner.create.employee.btn</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="disaster_member_belts.view_partner_belt_rank_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <!-- Show only when: is_instructor=True AND no employee record yet -->
                <button
                    class="oe_stat_button"
                    type="object"
                    name="action_create_employee_profile"
                    icon="fa-id-card"
                    invisible="not is_instructor or employees_count != 0"
                    groups="hr.group_hr_user"
                    title="Create an HR Employee record for this instructor"
                >
                    <div class="o_stat_info">
                        <span class="o_stat_text">Create Employee</span>
                    </div>
                </button>
            </xpath>
        </field>
    </record>

</odoo>
