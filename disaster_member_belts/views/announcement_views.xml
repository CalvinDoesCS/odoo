<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ============================================================
         Announcements â€“ List
    ============================================================ -->
    <record id="view_announcement_list" model="ir.ui.view">
        <field name="name">disaster.announcement.list</field>
        <field name="model">disaster.announcement</field>
        <field name="arch" type="xml">
            <list string="Announcements"
                  decoration-muted="not active"
                  decoration-success="is_active_now"
                  decoration-warning="priority == '1'"
                  decoration-danger="priority == '2'">
                <field name="priority" widget="priority" optional="show"/>
                <field name="is_pinned" string="ðŸ“Œ" optional="show"/>
                <field name="name"/>
                <field name="announcement_type"/>
                <field name="audience"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="is_active_now" string="Live" widget="boolean"/>
                <field name="active" column_invisible="1"/>
            </list>
        </field>
    </record>

    <!-- ============================================================
         Announcements â€“ Kanban
    ============================================================ -->
    <record id="view_announcement_kanban" model="ir.ui.view">
        <field name="name">disaster.announcement.kanban</field>
        <field name="model">disaster.announcement</field>
        <field name="arch" type="xml">
            <kanban quick_create="false" class="o_kanban_small_column">
                <field name="name"/>
                <field name="announcement_type"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="priority"/>
                <field name="is_pinned"/>
                <field name="is_active_now"/>
                <field name="image_thumbnail"/>
                <templates>
                    <t t-name="card">
                        <div class="d-flex flex-column gap-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <strong><field name="name"/></strong>
                                <field name="priority" widget="priority" class="float-end"/>
                            </div>
                            <div class="text-muted small">
                                <field name="announcement_type"/>
                            </div>
                            <div class="small">
                                <i class="fa fa-calendar me-1"/>
                                <field name="date_start" widget="datetime" options="{'format': 'dd/MM/yy'}"/>
                                <t t-if="record.date_end.value">
                                    â†’ <field name="date_end" widget="datetime" options="{'format': 'dd/MM/yy'}"/>
                                </t>
                            </div>
                            <div t-if="record.is_active_now.raw_value"
                                 class="badge bg-success text-white mt-1">Live Now</div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- ============================================================
         Announcements â€“ Form
    ============================================================ -->
    <record id="view_announcement_form" model="ir.ui.view">
        <field name="name">disaster.announcement.form</field>
        <field name="model">disaster.announcement</field>
        <field name="arch" type="xml">
            <form string="Announcement">
                <header>
                    <field name="active" widget="boolean_toggle" string="Active"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" placeholder="e.g. Belt Test this Saturday!"/></h1>
                    </div>

                    <group>
                        <group string="Details">
                            <field name="announcement_type"/>
                            <field name="audience"/>
                            <field name="priority" widget="priority"/>
                            <field name="is_pinned"/>
                            <field name="author_id"/>
                        </group>
                        <group string="Display Window">
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <field name="is_active_now" readonly="1" widget="boolean_toggle"/>
                        </group>
                    </group>

                    <group string="Banner Image">
                        <field name="image" widget="image"
                               options="{'size': [900, 400]}"
                               nolabel="1"/>
                    </group>

                    <group string="Short Summary">
                        <field name="summary" nolabel="1"
                               placeholder="One-line teaser for the kiosk carouselâ€¦"/>
                    </group>

                    <group string="Full Message">
                        <field name="body" nolabel="1"
                               widget="html"
                               placeholder="Full announcement bodyâ€¦"/>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- ============================================================
         Announcements â€“ Search
    ============================================================ -->
    <record id="view_announcement_search" model="ir.ui.view">
        <field name="name">disaster.announcement.search</field>
        <field name="model">disaster.announcement</field>
        <field name="arch" type="xml">
            <search string="Search Announcements">
                <field name="name"/>
                <field name="announcement_type"/>
                <filter string="Live Now" name="live_now"
                        domain="[('is_active_now','=',True)]"/>
                <filter string="Pinned" name="pinned"
                        domain="[('is_pinned','=',True)]"/>
                <filter string="Active" name="active"
                        domain="[('active','=',True)]"/>
                <filter string="Archived" name="archived"
                        domain="[('active','=',False)]"/>
                <separator/>
                <filter string="Type" name="grp_type"
                        context="{'group_by': 'announcement_type'}"/>
                <filter string="Audience" name="grp_audience"
                        context="{'group_by': 'audience'}"/>
            </search>
        </field>
    </record>

    <!-- ============================================================
         Action
    ============================================================ -->
    <record id="action_announcement" model="ir.actions.act_window">
        <field name="name">Announcements</field>
        <field name="res_model">disaster.announcement</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_active': True}</field>
    </record>

</odoo>
